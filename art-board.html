<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  .art-board {
    width: 600px;
    height: 500px;
    padding: 10px;
    background-color: pink;
    border-radius: 4px;
  }

  .toolbar {
    display: flex;
    align-items: center;
    height: 30px;
    column-gap: 20px;
    margin-bottom: 10px;
  }

  .item {
    width: 30px;
    height: 30px;
    background-color: skyblue;
    display: grid;
    place-items: center;
    border-radius: 4px;
    cursor: pointer;
  }

  .rect {
    width: 15px;
    height: 10px;
    border: 2px solid;
  }

  .circle {
    width: 13px;
    height: 13px;
    border: 2px solid;
    border-radius: 50%;
  }

  #canvas {
    background-color: #fff;
    border: 1px solid;
  }
</style>

<body>
  <div class="art-board">
    <div class="toolbar">
      <div class="item" id="brush">üñåÔ∏è</div>
      <div class="item" id="rect">
        <div class="rect"></div>
      </div>
      <div class="item" id="circle">
        <div class="circle"></div>
      </div>
      <button id="clearBtn">Ê∏ÖÁ©∫</button>
      <button id="saveBtn">‰øùÂ≠ò</button>
    </div>
    <canvas id="canvas" width="600px" height="450px"></canvas>
  </div>
  <script>
    const canvas = document.getElementById('canvas')
    const brush = document.getElementById('brush')
    const rect = document.getElementById('rect')
    const circle = document.getElementById('circle')
    const clearBtn = document.getElementById('clearBtn')
    const saveBtn = document.getElementById('saveBtn')
    const ctx = canvas.getContext('2d')
    const color = '#000'
    let beginX = 0
    let beginY = 0
    // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊìç‰ΩúÁ±ªÂûãÔºåÁîªÁ¨îbrush / Áü©ÂΩ¢rect / ÂúÜÂΩ¢circle
    let type = 'brush'
    let isDrawing = false
    // ÁªòÂà∂ÁªìÊûú
    let imageData = null

    // Áî®‰∫éÂ∞ÜËÉåÊôØËâ≤Ê∂ÇÊàêÁôΩËâ≤ÔºåÈÅøÂÖç‰øùÂ≠òÊó∂ËÉåÊôØ‰∏∫ÈÄèÊòé
    const restart = () => {
      ctx.beginPath()
      ctx.fillStyle = '#fff'
      ctx.rect(0, 0, 600, 450)
      ctx.fill()
      ctx.closePath()
      imageData = ctx.getImageData(0, 0, 600, 450)
      ctx.fillStyle = color
      ctx.strokeStyle = color
    }
    restart()



    brush.onclick = () => { type = 'brush' }
    rect.onclick = () => { type = 'rect' }
    circle.onclick = () => { type = 'circle' }

    // Ê∏ÖÁ©∫ÊåâÈíÆ
    clearBtn.onclick = () => {
      ctx.clearRect(0, 0, 600, 450)
      imageData = null
      restart()
    }
    // ‰øùÂ≠òÊåâÈíÆ
    saveBtn.onclick = () => {
      // toDataURL ÂèØ‰ª•Â∞ÜcanvasÁîüÊàê‰∏Ä‰∏™ÂâçÁºÄ‰∏∫ data: ÂçèËÆÆÁöÑURLÔºåÈªòËÆ§ÁîüÊàêpng
      const url = canvas.toDataURL()
      // Âä®ÊÄÅÁîüÊàêaÊ†áÁ≠æÂÆûÁé∞ÁÇπÂáª‰∏ãËΩΩ
      const a = document.createElement("a")
      // ËÆæÁΩÆ‰∏ãËΩΩÁöÑÊñá‰ª∂Âêç
      a.download = "art-board-img"
      a.href = url
      document.body.appendChild(a)
      a.click()
      document.body.removeChild(a)
    }


    // ‰∏çÂêåÁ±ªÂûãÂØπÂ∫îÁöÑÊìç‰ΩúÂáΩÊï∞
    const handler = {
      // Ê≥®ÊÑèÔºöÈÄöËøáËøôÁßçÊñπÂºèÁªòÂà∂Ë∑ØÂæÑÔºåÂΩìÈº†Ê†áÁßªÂä®ÈÄüÂ∫¶ËøáÂø´Êó∂‰ºöÊúâË∑ØÂæÑ‰∏çËøûË¥ØÈóÆÈ¢ò
      brush: (e) => {
        const x = e.pageX - canvas.offsetLeft
        const y = e.pageY - canvas.offsetTop
        ctx.beginPath()
        ctx.arc(x, y, 10, 0, 2 * Math.PI)
        ctx.fill()
        ctx.closePath()
      },
      rect: (e) => {
        const x = e.pageX - canvas.offsetLeft
        const y = e.pageY - canvas.offsetTop
        // Èº†Ê†áÁßªÂä®ËøáÁ®ã‰∏≠‰ºö‰∏çÊñ≠Ëß¶ÂèëÈáçÂ§çÁªòÂà∂ÔºåÂõ†Ê≠§ÈúÄÂÖàÊ∏ÖÈô§ÁßªÂä®ËøáÁ®ã‰∏≠ÁªòÂà∂ÁöÑÂõæÂΩ¢
        ctx.clearRect(0, 0, 600, 450)
        // ÊÅ¢Â§ç‰∏∫mousedownÊó∂ÁöÑÂÜÖÂÆπ
        imageData && ctx.putImageData(imageData, 0, 0, 0, 0, 600, 450)
        ctx.beginPath()
        ctx.rect(beginX, beginY, x - beginX, y - beginY)
        ctx.stroke()
        ctx.closePath()
      },
      circle: (e) => {
        const x = e.pageX - canvas.offsetLeft
        const y = e.pageY - canvas.offsetTop
        ctx.clearRect(0, 0, 600, 450)
        imageData && ctx.putImageData(imageData, 0, 0, 0, 0, 600, 450)
        ctx.beginPath()
        // Math.round ÂõõËàç‰∫îÂÖ•
        // Math.sqrt ËøîÂõû‰∏Ä‰∏™Êï∞ÁöÑÂπ≥ÊñπÊ†πÔºåËøôÈáåÈÄöËøáÂãæËÇ°ÂÆöÁêÜËÆæÁΩÆÂúÜÁöÑÂçäÂæÑ
        ctx.arc(
          beginX,
          beginY,
          Math.round(
            Math.sqrt((x - beginX) * (x - beginX) + (y - beginY) * (y - beginY))
          ),
          0,
          2 * Math.PI
        )
        ctx.stroke()
        ctx.closePath()
      },
    }

    document.body.onmouseup = () => { isDrawing = false }
    canvas.onmousedown = (e) => {
      isDrawing = true
      beginX = e.pageX - canvas.offsetLeft
      beginY = e.pageY - canvas.offsetTop
    }
    canvas.onmouseup = () => {
      isDrawing = false
      imageData = ctx.getImageData(0, 0, 600, 450)
    }
    canvas.onmousemove = (e) => {
      if (!isDrawing) return
      handler[type](e)
    }
  </script>
</body>

</html>